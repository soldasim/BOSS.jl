<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example · BOSS.jl</title><meta name="title" content="Example · BOSS.jl"/><meta property="og:title" content="Example · BOSS.jl"/><meta property="twitter:title" content="Example · BOSS.jl"/><meta name="description" content="Documentation for BOSS.jl."/><meta property="og:description" content="Documentation for BOSS.jl."/><meta property="twitter:description" content="Documentation for BOSS.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BOSS.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">BOSS</a></li><li><a class="tocitem" href="../functions/">Functions</a></li><li><a class="tocitem" href="../types/">Data Types &amp; Structures</a></li><li class="is-active"><a class="tocitem" href>Example</a><ul class="internal"><li><a class="tocitem" href="#The-Problem"><span>The Problem</span></a></li><li><a class="tocitem" href="#Problem-Definition"><span>Problem Definition</span></a></li><li><a class="tocitem" href="#Surrogate-Model-Definition"><span>Surrogate Model Definition</span></a></li><li><a class="tocitem" href="#Hyperparameter-Priors"><span>Hyperparameter Priors</span></a></li><li><a class="tocitem" href="#Model-Fitter"><span>Model Fitter</span></a></li><li><a class="tocitem" href="#Acquisition-Maximizer"><span>Acquisition Maximizer</span></a></li><li><a class="tocitem" href="#Acquisition-Function"><span>Acquisition Function</span></a></li><li><a class="tocitem" href="#Miscellaneous"><span>Miscellaneous</span></a></li><li><a class="tocitem" href="#Run-BOSS"><span>Run BOSS</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/soldasim/BOSS.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/soldasim/BOSS.jl/blob/master/docs/src/example.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h1><p>An illustrative problem is solved using BOSS.jl here. The source code is available at <a href="https://github.com/soldasim/BOSS.jl/blob/master/scripts/example.jl">github</a>.</p><h2 id="The-Problem"><a class="docs-heading-anchor" href="#The-Problem">The Problem</a><a id="The-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#The-Problem" title="Permalink"></a></h2><p>We have an expensive-to-evaluate blackbox function <code>blackbox(x) -&gt; (y, z)</code>.</p><pre><code class="language-julia hljs">function blackbox(x; noise_std=0.1)
    y = exp(x[1]/10) * cos(2*x[1])
    z = (1/2)^6 * (x[1]^2 - (15.)^2)
    
    y += rand(Normal(0., noise_std))
    z += rand(Normal(0., noise_std))

    return [y,z]
end</code></pre><p>We wish to maximize <code>y</code> such that <code>x ∈ &lt;0, 20&gt;</code> (constraint on input) and <code>z &lt; 0</code> (constraint on output).</p><h2 id="Problem-Definition"><a class="docs-heading-anchor" href="#Problem-Definition">Problem Definition</a><a id="Problem-Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-Definition" title="Permalink"></a></h2><p>First, we define the problem as an instance of <a href="../types/#BOSS.BossProblem"><code>BossProblem</code></a>.</p><pre><code class="language-julia hljs">problem() = BossProblem(;
    fitness = LinFitness([1, 0]),           # maximize y
    f = blackbox,
    domain = Domain(;
        bounds = ([0.], [20.]),             # x ∈ &lt;0, 20&gt;
    ),
    y_max = [Inf, 0.],                      # z &lt; 0
    model = nonparametric(), # or `parametric()` or `semiparametric()`
    noise_std_priors = noise_std_priors(),
    data = init_data(),
)</code></pre><p>We use <a href="../types/#Fitness"><code>Fitness</code></a> to define the objective. Here, the <code>LinFitness([1, 0])</code> specifies that we wish to maximize <code>1*y + 0*z</code>. (See also <a href="../types/#BOSS.NonlinFitness"><code>NonlinFitness</code></a>.)</p><p>We use the keyword <code>f</code> to provide the blackbox objective function.</p><p>We use the <a href="../types/#BOSS.Domain"><code>Domain</code></a> structure to define the constraints on inputs.</p><p>We use the keyword <code>y_max</code> to define the constraints on outputs.</p><h2 id="Surrogate-Model-Definition"><a class="docs-heading-anchor" href="#Surrogate-Model-Definition">Surrogate Model Definition</a><a id="Surrogate-Model-Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Surrogate-Model-Definition" title="Permalink"></a></h2><p>Now we define the surrogate model used to approximate the objective function based on the available data from previous evaluations.</p><h3 id="Gaussian-Process"><a class="docs-heading-anchor" href="#Gaussian-Process">Gaussian Process</a><a id="Gaussian-Process-1"></a><a class="docs-heading-anchor-permalink" href="#Gaussian-Process" title="Permalink"></a></h3><p>Usually, we will use a Gaussian process.</p><pre><code class="language-julia hljs">nonparametric() = GaussianProcess(;
    kernel = BOSS.Matern32Kernel(),
    amp_priors = amplitude_priors(),
    length_scale_priors = length_scale_priors(),
)</code></pre><h3 id="Parametric-Model"><a class="docs-heading-anchor" href="#Parametric-Model">Parametric Model</a><a id="Parametric-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Parametric-Model" title="Permalink"></a></h3><p>If we have some knowledge about the blackbox function, we can define a parametric model.</p><pre><code class="language-julia hljs">parametric() = NonlinModel(;
    predict = (x, θ) -&gt; [
        θ[1] * x[1] * cos(θ[2] * x[1]) + θ[3],
        0.,
    ],
    param_priors = fill(Normal(0., 1.), 3),
)</code></pre><p>The function <code>predict(x, θ) -&gt; y</code> defines our parametric model where <code>θ</code> are the model parameters which will be fitted based on the data.</p><p>The keyword <code>param_priors</code> is used to define priors on the model parameters <code>θ</code>. The priors can be used to include our expert knowledge, to regularize the model, or a uniform prior can be used to not bias the model fit.</p><h3 id="Semiparametric-Model"><a class="docs-heading-anchor" href="#Semiparametric-Model">Semiparametric Model</a><a id="Semiparametric-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Semiparametric-Model" title="Permalink"></a></h3><p>We can use the parametric model together with a Gaussian process to define the semiparametric model.</p><pre><code class="language-julia hljs">semiparametric() = Semiparametric(
    parametric(),
    nonparametric(),
)</code></pre><p>This allows us to leverage our expert knowledge incorporated in the parametric model while benefiting from the flexibility of the Gaussian process.</p><h2 id="Hyperparameter-Priors"><a class="docs-heading-anchor" href="#Hyperparameter-Priors">Hyperparameter Priors</a><a id="Hyperparameter-Priors-1"></a><a class="docs-heading-anchor-permalink" href="#Hyperparameter-Priors" title="Permalink"></a></h2><p>We need to define all hyperparameters. Instead of defining scalar values, we will define priors over them and let BOSS fit their values based on the data. This alleviates the importance of our choice and allows for Bayesian inference if we wish to use it.</p><p>(If one wants to define some hyperparameters as scalars instead, a <code>Dirac</code> prior can be used and the hyperparameters will be skipped from model fitting.)</p><h3 id="Evaluation-Noise"><a class="docs-heading-anchor" href="#Evaluation-Noise">Evaluation Noise</a><a id="Evaluation-Noise-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluation-Noise" title="Permalink"></a></h3><p>BOSS assumes Gaussian evaluation noise on the objective blackbox function. Noise std priors define our belief about the standard deviation of the noise of each individual output dimension.</p><pre><code class="language-julia hljs">noise_std_priors() = fill(truncated(Normal(0., 0.1); lower=0.), 2)
# noise_std_priors() = fill(Dirac(0.1), 2)</code></pre><h3 id="Amplitude"><a class="docs-heading-anchor" href="#Amplitude">Amplitude</a><a id="Amplitude-1"></a><a class="docs-heading-anchor-permalink" href="#Amplitude" title="Permalink"></a></h3><p>The amplitude of the Gaussian process expresses the expected deviation of the output values. We again define an amplitude prior for each individual output dimension.</p><pre><code class="language-julia hljs">amplitude_priors() = fill(truncated(Normal(0., 5.); lower=0.), 2)
# amplitude_priors() = fill(Dirac(5.), 2)</code></pre><h3 id="Length-Scales"><a class="docs-heading-anchor" href="#Length-Scales">Length Scales</a><a id="Length-Scales-1"></a><a class="docs-heading-anchor-permalink" href="#Length-Scales" title="Permalink"></a></h3><p>Informally, the length scales of the Gaussian process define how far within the input domain does the model extrapolate the information obtained from the dataset. For each output dimension, we define a multivariate prior over all input dimensions. (In our case two 1-variate priors.)</p><pre><code class="language-julia hljs">length_scale_priors() = fill(Product([truncated(Normal(0., 20/3); lower=0.)]), 2)
# length_scale_priors() = fill(Product(fill(Dirac(1.), 1)), 2)</code></pre><h2 id="Model-Fitter"><a class="docs-heading-anchor" href="#Model-Fitter">Model Fitter</a><a id="Model-Fitter-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Fitter" title="Permalink"></a></h2><p>We can specify the algorithm used to fit the model hyperparameters using the <a href="../types/#BOSS.ModelFitter"><code>ModelFitter</code></a> type.</p><p>We can fit the hyperparameters in a MAP fashion using the <a href="../types/#BOSS.OptimizationMAP"><code>OptimizationMAP</code></a> model fitter together with any algorithm from <code>Optimization.jl</code> and its extensions.</p><pre><code class="language-julia hljs">using OptimizationPRIMA

map_fitter() = OptimizationMAP(;
    algorithm = NEWUOA(),
    multistart = 20,
    parallel = true,
    rhoend = 1e-4,
)</code></pre><p>Or we can use Bayesian inference and sample the parameters from their posterior (given by the priors and the data likelihood) using the <a href="../types/#BOSS.TuringBI"><code>TuringBI</code></a> model fitter.</p><pre><code class="language-julia hljs">bi_fitter() = TuringBI(;
    sampler = BOSS.PG(20),
    warmup = 100,
    samples_in_chain = 10,
    chain_count = 8,
    leap_size = 5,
    parallel = true,
)</code></pre><p>See also <a href="../types/#BOSS.SamplingMAP"><code>SamplingMAP</code></a> and <a href="../types/#BOSS.RandomMAP"><code>RandomMAP</code></a> for more trivial model fitters suitable for simple experimentation with the package.</p><h2 id="Acquisition-Maximizer"><a class="docs-heading-anchor" href="#Acquisition-Maximizer">Acquisition Maximizer</a><a id="Acquisition-Maximizer-1"></a><a class="docs-heading-anchor-permalink" href="#Acquisition-Maximizer" title="Permalink"></a></h2><p>We can specify the algorithm used to maximize the acquisition function (in order to select the next evaluation point) by using the <a href="../types/#BOSS.AcquisitionMaximizer"><code>AcquisitionMaximizer</code></a> type.</p><p>We can use the <a href="../types/#BOSS.OptimizationAM"><code>OptimizationAM</code></a> maximizer together with any algorithm from <code>Optimization.jl</code>.</p><pre><code class="language-julia hljs">acq_maximizer() = OptimizationAM(;
    algorithm = BOBYQA(),
    multistart = 20,
    parallel = true,
    rhoend = 1e-4,
)</code></pre><p>Make sure to use an algorithm suitable for the given domain. (For example, in our case the domain is bounded by box constraints only, so we the BOBYQA optimization algorithm designed for box constraints problems.)</p><p>See also <a href="../types/#BOSS.GridAM"><code>GridAM</code></a>, <a href="../types/#BOSS.RandomAM"><code>RandomAM</code></a> for more trivial acquisition maximizers suitable for simple experimentation with the package.</p><p>The <a href="../types/#BOSS.SequentialBatchAM"><code>SequentialBatchAM</code></a> can be used to wrap any of the other acquisition maximizers to enable objective function evaluation in batches.</p><h2 id="Acquisition-Function"><a class="docs-heading-anchor" href="#Acquisition-Function">Acquisition Function</a><a id="Acquisition-Function-1"></a><a class="docs-heading-anchor-permalink" href="#Acquisition-Function" title="Permalink"></a></h2><p>The acquisition function defines how the next evaluation point is selected in each iteration. The acquisition function is maximized by the acquisition maximizer algorithm (discussed in the previous section).</p><p>Currently, the only implemented acquisition function is the <a href="../types/#BOSS.ExpectedImprovement"><code>ExpectedImprovement</code></a> acquisition most commonly used in Bayesian optimization.</p><h2 id="Miscellaneous"><a class="docs-heading-anchor" href="#Miscellaneous">Miscellaneous</a><a id="Miscellaneous-1"></a><a class="docs-heading-anchor-permalink" href="#Miscellaneous" title="Permalink"></a></h2><p>Finally, we can define the termination condition using the <a href="../types/#BOSS.TermCond"><code>TermCond</code></a> type. Currently, the only available termination condition is the trivial <a href="../types/#BOSS.IterLimit"><code>IterLimit</code></a> condition. (However, one can simply define his own termination condition by extending the <a href="../types/#BOSS.TermCond"><code>TermCond</code></a> type.)</p><p>The <a href="../types/#BOSS.BossOptions"><code>BossOptions</code></a> structure can be used to change other miscellaneous settings.</p><p>The <a href="../types/#BOSS.PlotCallback"><code>PlotCallback</code></a> can be provided in <a href="../types/#BOSS.BossOptions"><code>BossOptions</code></a> to enable plotting of the BO procedure. This can be useful for initial experimentation with the package. Note that the plotting only works for 1-dimensional input domains.</p><pre><code class="language-julia hljs">using Plots

options() = BossOptions(;
    info = true,
    callback = PlotCallback(Plots;
        f_true = x-&gt;blackbox(x; noise_std=0.),
    ),
)</code></pre><h2 id="Run-BOSS"><a class="docs-heading-anchor" href="#Run-BOSS">Run BOSS</a><a id="Run-BOSS-1"></a><a class="docs-heading-anchor-permalink" href="#Run-BOSS" title="Permalink"></a></h2><p>Once we define the problem and all hyperparameters, we can run the BO procedure by calling the <code>bo!</code> function.</p><pre><code class="language-julia hljs">bo!(problem();
    model_fitter = map_fitter(), # or `bi_fitter()`
    acq_maximizer = acq_maximizer(),
    acquisition = ExpectedImprovement(),
    term_cond = IterLimit(10),
    options = options(),
)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../types/">« Data Types &amp; Structures</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Thursday 1 August 2024 13:21">Thursday 1 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
